# Ссылка на датасет

Датасет размеченных картинок (всего 74)
[Датасет](https://disk.yandex.ru/d/RlW-0dqfkZciDQ)

Пример размеченной картинки из датасета:
![Пример](images/data.png)

# Содержимое репозитория [отчет]

## Задача

Разработать программный код для генерации синтетических, но реалистичных изображений штрихкодов с разметкой, чтобы дополнить существующие датасеты для обучения моделей распознавания.

### input / output

**input:**    параметры гренерации, датасет MIDV для основы;\
**output:**   сгенерированные изображения с разметкой;

### критерии оценки

- Реалистичность данных
- Разнообразие данных
- Улучшилось ли качетсво при использовании синтетических данных в обучении

### данные

В качестве фона для баркодов используются данные из датсета [MIDV](https://www.kaggle.com/datasets/kontheeboonmeeprakob/midv500)

### ограничения

- **Искажения**
    - проективное искажение;
    - увеличение / уменьшение относительного размера баркода;
    - поворот;
    - наложение баркодов друг на друга;
    - ~~мятые искажения~~;
    - ~~выбитые барсели~~;
    - ~~обрезанная часть баркода~~;
- **Количество бракодов и их разнообразие на снимке**
    - один баркод на изображении;
    - несколько одинаковых баркодов;
    - несколько разных баркодов;
- **Типы баркодов**
    - qrcode;
    - azteccode;
    - pdf417;
    - datamatrix;
    - code128;
    - code39;
    - ean13;
    - ean14;
    - ean8;
    - issn;
    - microqrcode;
    - upca;
    - pzn;

## Описание метода

1. С помощью библиотеки treepoem генерируется баркод.
2. Выбирается рандомное изображение из датасета MIDV.
3. Создается "холст" размером с документ.
4. Создается баркод случайный или указанный в параметрах, случайного размера относительно холста, но такой чтобы поместился.
5. Применяется случайный поворот баркода.
6. Создается маска баркода и выбирается случайное место для его прикрепления к холсту, такое чтобы баркод не выходил за пределы.
7. При нескольких баркодах шаги 4 - 6 повтораяются.
8. К холсту вместе с баркодом применяется проективное искажение в соответсвии с данными из MIDV.
9. "Холст" с некоторым сглаживанием границ крепится к изображению фона.
10. Создается разметка для всех баркодов, устанавливаются наложения баркодов друг на друга и добавляется тег: id (impossible to detect).
11. Результирующие разметка и изображение кладутся в директорию ./simulation/result_data .

## Результаты

Ипользуя за основу датасет MIDV можно создать данные содержащие баркоды и разметку к ним. Которые при этом выглядят реалистично.

![Пример](images/ok_0.png)

Ссылка на датасет сгенерированных изображений (всего 55):
[Симуляционный датасет](https://disk.yandex.ru/d/sDpicGTVILX3gw)

### ПО (инструкция)

Инструкцию по использованию кода можно найти здесь: [Инструкция](https://github.com/Keiko-Chan/mipt2025-Dudenko-E-I/blob/main/simulation/Readme.md)

#### Данные для фона

Нужно скачать себе данные из датасета MIDV (всё скачивать не обязательно).
[Скачать можно тут](https://www.kaggle.com/datasets/kontheeboonmeeprakob/midv500)
Датасет для примера: [midv_example](https://disk.yandex.ru/d/vnIrFwIuRCui6g)

**Важно**

Структуру расположения файлов в датасете не ломайте!

Должна быть такой (пример):

**MIDV**
- **01_doc**
    - **ground_truth**
        - **dir0**
            - img1.json
            - img2.json
            - ...
        - **dir1**
        - **...*
    - **images**
        - **dir0**
            - img1.tif
            - img2.tif
            - ...
        - **dir1**
        - **...**
        - 01_doc.tif
- **...**


#### Запуск

Запуск происходит из директории simulation.

```
#Генерирует 10 картинок, рандомных типов баркодов, с рандомными данными в них.

python3 simulate.py midv_path  --amount 10 --name sim1_
```

```
#Генерирует 5 картинок, содержащие только microqr, содержащие строку some_data.

python3 simulate.py midv_path --bar_type microqr --data some_data --amount 5 --name sim2_

```

Разберемся что есть что:

- *midv_path* -- путь директории MIDV, (не к той директории где она находится, а к ней самой)
- *--amount 5* --  аргумент по желанию, это то сколько изображений хотите получить
- *--bar_type* --  тип баркода для генерации, все баркоды будут этого вида (посмотрите в generator.py есть словари gen1_types и gen2_types, сюда нужен ключ)
- *--data* -- то что кодируем, тоже для всех кодов одно и то же (можно посмотреть в types.md, там не вся информация актуальна, но что примерно может ожидать тот или иной тип баркода написано)
- *--name* -- имя прибавляющееся к названию получающхся разметок и изображений (при совпадении имен данные будут перезаписываться)

Если не указывать bar_type и data, то они будут рандомные из возможных. Также не указывайте data без bar_type, и следите за тем чтобы они между собой были согласованы, когда указываете.


### Результат запуска

 Получившиеся картинки складываются в simulation/result_data/images, разметка к ним в simulation/result_data/markup.
  **Важно!** Если запустите программу снова картинки перезапишутся, если их name и нумерация совпадают.

### анализ сложных случаев

- Код работает довольно долго, не оптимизирован;
- Тэг id (impossible to detect) добавляется при любом значимом перекрытии, даже если код в теории еще можно декодировать, пока не понятно как отличить такой случай от мешающего перекрытия;


Баркод размечен как id, но при этом все еще распознаваем.
![Пример](images/0.png)

### дальнейшие действия

- расширение ограничений наложенных на генерацию баркода;
- добавить что-то кроме белого фона для баркода;
- оптимизация времени работы;
- удобный файл с параметрами;

### показатели / измерения

Синтетические данные использовались для обучения, результат не известен.

### ~~описание данных~~




